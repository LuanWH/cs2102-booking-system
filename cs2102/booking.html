<!DOCTYPE html>      
<html>   

  <head>

    <title>Ticket Booking</title>
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <script src="js/jquery.min.js"></script>

  </head>
  <body>
    <div class="table-responsive">
      <font style = "font-size:30px">Book Your Tickets</font>
      <form>
        <p>User Name: <input type="text" name="name" id="UserName"></p> 
         
        <br>
        <p>Cinema: </p>
        <select id="Cinema" name="cinema"> 
          <option value="">Select Cinema</option>
        </select>
        <div id = "CinemaMsgContainer"></div>
        <br>

        <p>Movie: </p>
        <select id="Movie" name = "movie"> 
          <option value="">Select Movie</option>
        </select>
        <div id = "MovieMsgContainer"></div>
        <br>
        <p>Timeslot: </p>
        <select id="Timeslot" name="timeslot"> 
          <option value="">Select Timeslot</option>
        </select>
        <div id = "TimeslotMsgContainer"></div>
        <br>        

        <button>Book!</button>
      </form>
    </div>
    <script type="text/javascript">
      var timeSlotMap = [];
      function fetchTimeslots(cinemaName, movieTitle){
        if(cinemaName != null && cinemaName != "" &&
           movieTitle != null && movieTitle != ""){
          $.ajax({
            url:'fetchTimeslots.php',
            type: 'post',
            data: {'cinemaName': cinemaName,
                   'movieTitle': movieTitle},
            dataType: 'text',
            success: function (response) {
              timeSlotMap = eval(response);
              $('#Timeslot').empty();
              $('#TimeslotMsgContainer').empty();
              $('#Timeslot').html('<option value=\""\"">Select Timeslot</option>');
              for(var i = 0; i < timeSlotMap.length; i++){
                $('#Timeslot').append('<option value='+i+'>'+
                                    timeSlotMap[i].startTime+' to '+
                                    timeSlotMap[i].endTime + ' at hall '+
                                    timeSlotMap[i].hallID+'</option>');
              }
            },
            error: function () {
              $('#Timeslot').empty();
              $('#Timeslot').html('<option value=\""\"">Select Timeslot</option>');
              $('#TimeslotMsgContainer').html('<p>Error when fetching timeslot data.</p>');
            }
          });           
        }
      }

      function fetchMovies(cinemaName) {
        if(cinemaName != null && cinemaName != ""){
          $.ajax({
            url:'fetchMovies.php',
            type: 'post',
            data: {'cinemaName': cinemaName},
            success: function (response) {
              $('#Movie').empty();
              $('#Movie').html('<option value=\""\"">Select Movie</option>');
              $('#Movie').append(response);
              $('#MovieMsgContainer').empty();
            },
            error: function () {
              $('#Movie').empty();
              $('#Movie').html('<option value=\""\"">Select Movie</option>');
              $('#MovieMsgContainer').html('<p>Error when fetching cinema ' + cinemaName + ' movie data.</p>');
            }
          });          
        }
        return true;
      }

      function fetchCinemas() {

          $.ajax({
            url:'fetchCinemas.php',
            dataType: 'text',
            success: function (response) {
              $('#Cinema').empty();
              $('#Cinema').html('<option value=\""\"">Select Cinema</option>');
              $('#Cinema').append(response);
              $('#CinemaMsgContainer').empty();
            },
            error: function (ignore0, ignore1, ignore2) {
              $('#Cinema').empty();
              $('#Cinema').html('<option value=\""\"">Select Cinema</option>');
              $('#CinemaMsgContainer').append('<p>Error when fetching cinema data.</p>');
            }
          });                
        }

      $(document).ready(function(){

        fetchCinemas();

        $( "#Cinema" ).change(function() {
          var selectedCinema = $('#Cinema').val();
          fetchMovies(selectedCinema);
        });

        $("#Movie").change(function(){
          var selectedMovie = $('#Movie').val();
          var selectedCinema = $('#Cinema').val();
          fetchTimeslots(selectedCinema, selectedMovie);
        });
      });
    </script>    
  </body> 

</html>            